/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(a,b){if(typeof exports==="object"&&exports){b(exports)}else{var c={};b(c);if(typeof define==="function"&&define.amd){define(c)}else{a.Mustache=c}}}(this,function(a){var e=/\s*/;var l=/\s+/;var j=/\S/;var h=/\s*=/;var n=/\s*\}/;var t=/#|\^|\/|>|\{|&|=|!/;var f=RegExp.prototype.test;function s(z,y){return f.call(z,y)}function g(y){return !s(j,y)}var v=Object.prototype.toString;var k=Array.isArray||function(y){return v.call(y)==="[object Array]"};function d(y){return y.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function m(y){return String(y).replace(/[&<>"'\/]/g,function(z){return c[z]})}function u(y){this.string=y;this.tail=y;this.pos=0}u.prototype.eos=function(){return this.tail===""};u.prototype.scan=function(z){var y=this.tail.match(z);if(y&&y.index===0){this.tail=this.tail.substring(y[0].length);this.pos+=y[0].length;return y[0]}return""};u.prototype.scanUntil=function(z){var y,A=this.tail.search(z);switch(A){case -1:y=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:y="";break;default:y=this.tail.substring(0,A);this.tail=this.tail.substring(A);this.pos+=A}return y};function r(y,z){this.view=y||{};this.parent=z;this._cache={}}r.make=function(y){return(y instanceof r)?y:new r(y)};r.prototype.push=function(y){return new r(y,this)};r.prototype.lookup=function(y){var B=this._cache[y];if(!B){if(y=="."){B=this.view}else{var A=this;while(A){if(y.indexOf(".")>0){B=A.view;var C=y.split("."),z=0;while(B&&z<C.length){B=B[C[z++]]}}else{B=A.view[y]}if(B!=null){break}A=A.parent}}this._cache[y]=B}if(typeof B==="function"){B=B.call(this.view)}return B};function p(){this.clearCache()}p.prototype.clearCache=function(){this._cache={};this._partialCache={}};p.prototype.compile=function(A,y){var z=this._cache[A];if(!z){var B=a.parse(A,y);z=this._cache[A]=this.compileTokens(B,A)}return z};p.prototype.compilePartial=function(z,B,y){var A=this.compile(B,y);this._partialCache[z]=A;return A};p.prototype.getPartial=function(y){if(!(y in this._partialCache)&&this._loadPartial){this.compilePartial(y,this._loadPartial(y))}return this._partialCache[y]};p.prototype.compileTokens=function(A,z){var y=this;return function(B,D){if(D){if(typeof D==="function"){y._loadPartial=D}else{for(var C in D){y.compilePartial(C,D[C])}}}return o(A,y,r.make(B),z)}};p.prototype.render=function(A,y,z){return this.compile(A)(y,z)};function o(F,z,y,I){var C="";var A,G,H;for(var D=0,E=F.length;D<E;++D){A=F[D];G=A[1];switch(A[0]){case"#":H=y.lookup(G);if(typeof H==="object"){if(k(H)){for(var B=0,K=H.length;B<K;++B){C+=o(A[4],z,y.push(H[B]),I)}}else{if(H){C+=o(A[4],z,y.push(H),I)}}}else{if(typeof H==="function"){var J=I==null?null:I.slice(A[3],A[5]);H=H.call(y.view,J,function(L){return z.render(L,y)});if(H!=null){C+=H}}else{if(H){C+=o(A[4],z,y,I)}}}break;case"^":H=y.lookup(G);if(!H||(k(H)&&H.length===0)){C+=o(A[4],z,y,I)}break;case">":H=z.getPartial(G);if(typeof H==="function"){C+=H(y)}break;case"&":H=y.lookup(G);if(H!=null){C+=H}break;case"name":H=y.lookup(G);if(H!=null){C+=a.escape(H)}break;case"text":C+=G;break}}return C}function x(E){var z=[];var D=z;var F=[];var B;for(var A=0,y=E.length;A<y;++A){B=E[A];switch(B[0]){case"#":case"^":F.push(B);D.push(B);D=B[4]=[];break;case"/":var C=F.pop();C[5]=B[2];D=F.length>0?F[F.length-1][4]:z;break;default:D.push(B)}}return z}function b(D){var A=[];var C,z;for(var B=0,y=D.length;B<y;++B){C=D[B];if(C){if(C[0]==="text"&&z&&z[0]==="text"){z[1]+=C[1];z[3]=C[3]}else{z=C;A.push(C)}}}return A}function q(y){return[new RegExp(d(y[0])+"\\s*"),new RegExp("\\s*"+d(y[1]))]}function w(O,E){O=O||"";E=E||a.tags;if(typeof E==="string"){E=E.split(l)}if(E.length!==2){throw new Error("Invalid tags: "+E.join(", "))}var I=q(E);var A=new u(O);var G=[];var F=[];var D=[];var P=false;var N=false;function M(){if(P&&!N){while(D.length){delete F[D.pop()]}}else{D=[]}P=false;N=false}var B,z,H,J,C;while(!A.eos()){B=A.pos;H=A.scanUntil(I[0]);if(H){for(var K=0,L=H.length;K<L;++K){J=H.charAt(K);if(g(J)){D.push(F.length)}else{N=true}F.push(["text",J,B,B+1]);B+=1;if(J=="\n"){M()}}}if(!A.scan(I[0])){break}P=true;z=A.scan(t)||"name";A.scan(e);if(z==="="){H=A.scanUntil(h);A.scan(h);A.scanUntil(I[1])}else{if(z==="{"){H=A.scanUntil(new RegExp("\\s*"+d("}"+E[1])));A.scan(n);A.scanUntil(I[1]);z="&"}else{H=A.scanUntil(I[1])}}if(!A.scan(I[1])){throw new Error("Unclosed tag at "+A.pos)}C=[z,H,B,A.pos];F.push(C);if(z==="#"||z==="^"){G.push(C)}else{if(z==="/"){if(G.length===0){throw new Error('Unopened section "'+H+'" at '+B)}var y=G.pop();if(y[1]!==H){throw new Error('Unclosed section "'+y[1]+'" at '+B)}}else{if(z==="name"||z==="{"||z==="&"){N=true}else{if(z==="="){E=H.split(l);if(E.length!==2){throw new Error("Invalid tags at "+B+": "+E.join(", "))}I=q(E)}}}}}var y=G.pop();if(y){throw new Error('Unclosed section "'+y[1]+'" at '+A.pos)}F=b(F);return x(F)}a.name="mustache.js";a.version="0.7.2";a.tags=["{{","}}"];a.Scanner=u;a.Context=r;a.Writer=p;a.parse=w;a.escape=m;var i=new p();a.clearCache=function(){return i.clearCache()};a.compile=function(z,y){return i.compile(z,y)};a.compilePartial=function(z,A,y){return i.compilePartial(z,A,y)};a.compileTokens=function(z,y){return i.compileTokens(z,y)};a.render=function(A,y,z){return i.render(A,y,z)};a.to_html=function(B,z,A,C){var y=a.render(B,z,A);if(typeof C==="function"){C(y)}else{return y}}}));b$.module("b$.view.preferences",function(){var c=b$.bdom.getNamespace("http://backbase.com/2012/view").getClass("displayElement");c.prototype.namespaceURI="http://backbase.com/2012/view";var d=c.extend(null,{localName:"PreferenceForm",getTemplate:function(){return'<div class="bp-pref-pane"><form class="bp-pref-form bp--form"><table class="bp-pref-table xbp-area"></table><div class="bp-userPreferencesForm-buttonsPannel"><button class="bp-userPreferencesForm-button bp-userPreferencesForm-okButton" onclick="try{var pf=b$.getVC(this);pf.save();pf.dispatchCustomEvent(\'close\');}catch(err){console.log(err)};return false;">ok</button><button class="bp-userPreferencesForm-button bp-userPreferencesForm-cancelButton" onclick="try{var pf=b$.getVC(this);pf.reset();pf.dispatchCustomEvent(\'close\');}catch(err){console.log(err)};return false;">cancel</button></div><div class="bp-userPreferencesForm-end"></div></form></div>';return'<form class="bp-userPreferencesForm bp-gradient1 bp-userPreferencesForm-active"><div class="bp-userPreferencesForm-fields bp-area"></div><div class="bp-userPreferencesForm-buttonsPannel"><button class="bp-userPreferencesForm-button bp-userPreferencesForm-okButton" onclick="var pf=b$.getVC(this);pf.save();pf.dispatchCustomEvent("close");return false;">ok</button><button class="bp-userPreferencesForm-button bp-userPreferencesForm-cancelButton" onclick="var pf=b$.getVC(this);pf.reset();pf.dispatchCustomEvent("close");return false;">cancel</button></div><div class="bp-userPreferencesForm-end"></div></form>'},getRowTemplate:function(){return'<tr class="xbp-userPreferenceField"><td class="bp-pref-td-label"><label class="bp-pref-label" for="{{name}}">{{label}}</label></td><td class="bp-pref-td-input"></td></tr>'},insertDisplayChild:function(e,i){var g={};if(e.model){g={name:e.model.name,label:(e.model.label)?e.model.label:e.model.name};var h=jQuery(Mustache.to_html(this.getRowTemplate(),g))[0];jQuery(".bp-pref-td-input",h).append(e.htmlNode)}else{var h=e.htmlNode}var f=b$._private.htmlAPI.findCaptureClass("portalManagerPreferenceFieldView",this.htmlNode)[0];f.appendChild(h)},createDisplay:function(e){if(e){}else{e=$(Mustache.to_html(this.getTemplate(),this.model.getJSON()))[0]}this.htmlNode=e;this.htmlNode.viewController=this;this.htmlBody=b$._private.htmlAPI.findCaptureClass("bp-pref-table",e)[0];return e},handlePrefModified:function(e){switch(e.attrChange){case 1:break;case 2:break;case 3:break}},connectToModel:function(){this.model.addEventListener("*",function(e){console.log("model "+e.type)});this.model.addEventListener("PrefModified",this.handlePrefModified)},disconnectFromModel:function(){this.model.removeEventListener("PrefModified",this.handlePrefModified)},reset:function(){console.log("reset")},buildFieldsFromPreferences:function(k,h){var j=b$.portal.controllers.preferences;this.map={};this.itemModel=h;for(var g=0,e=k.length;g<e;g++){var f=(typeof k[g]=="string")?this.ownerDocument.createFromString(k[g]):j.reflect(k[g],this.ownerDocument);if(f){this.appendChild(f);this.map[k[g].name]=f}else{console.log("Reflection error ",k[g])}}},save:function(){var e=this.childNodes;var g={};for(var f=0;f<e.length;f++){if(e[f].model){g[e[f].model.name]=e[f].ctrl.getValue(e[f])}}this.dispatchCustomEvent("savePreferenceForm",true,true,g)},cancel:function(){},hasChanges:function(){this.bChanged=false;b$.bdom.util.callFunctionRecursively(this,function(e){if(this.isInputField){if(this.value!=this.model.value){console.log(this);e.bChanged=true;console.log(this.value,this.model.value)}}},[this]);console.log("bChanged "+this.bChanged)}},{actions:{cancel:function(){},save:function(){}},handlers:{click:function(f){if(f.target==this){var e=this.getDisplayEventTarget(f.htmlTarget);if(e){var g=e.getAttribute("data-action");if(g){this.dispatchCustomEvent(g)}}}},save:function(e){this.save();this.dispatchCustomEvent("closePreferenceForm",true,true)},cancel:function(e){this.cancel();this.dispatchCustomEvent("closePreferenceForm",true,true)},xDOMNodeInsertedIntoDocument:function(e){},xDOMNodeInserted:function(e){},xvalidate:function(e){}}});var b=c.extend(null,{localName:"BaseControl",cnBasePrefix:"bc-",cnBase:"",buildJSON:function(){},doTemplate:function(){return"<div></div>"},buildHTML:function(){var e=jQuery(this.doTemplate(this.buildJSON()))[0];return e},getBoolAttribute:function(f){var e=this.getAttribute(f);if(e&&e!="false"){return true}return false},setBoolAttribute:function(f,e){if(e){this.setAttribute(f,f)}else{this.removeAttribute(f)}},domActivate:function(){var e=new this.ownerDocument.createEvent("UIEvent");e.initUIEvent("DOMActivate",true,true,window,null);this.dispatchEvent(e)}});var a=b.extend(null,{localName:"FormControl",getForm:function(){var e=this.htmlNode;while(e){if(e.localName=="form"||e.nodeName.toLowerCase()=="form"){return e}e=e.parentNode}}});this.UserPreferenceField=b$.Class;this.UserPreferencesForm=b$.Class});b$.module("b$.portal._private.include",function(){var p=b$.Class;var m=b$._private.ArrayMap;var b=b$._private.ArrayCollection;var f=b$.bdom.events.EventTarget;var q=b$._private.types.TypeConstraintFn;var c=b$._private.types.TypeConstraintNull;var d=b$._private.types.TypeConstraintOptional;var i=b$._private.ArrayIterator;var h=b$._private.uri.URI;var j=b$._private.template.StringTemplate;var a=b$._private.htmlAPI;var n=/^__(WIDGET|GADGET)__/;var s=new q(function(t){return/^proxy|target$/.test(t)});var e=new d(s);var r=new q(function(t){return/^GET|POST$/.test(t)});var g=p.extend(function(v,w,u,t){this.name=new j(v);this.value=new j(w);this.destination=u;this.method=t},{toQueryString:function(u){var t=encodeURIComponent(this.getName(u));return this.getValues(u).map(function(z){if(n.test(z)){var y=z.split("."),w=u;for(var x=1,v=y.length;x<v;x++){w=w[y[x]]}z=w}return t+"="+encodeURIComponent(z)}).join("&")},getName:function(t){return((this.destination=="proxy"&&this.method=="POST")?g.PROXY_PARAM_PREFIX:"")+this.name.generate(t)},getValues:function(t){return[this.value.generate(t)]}},{PROXY_PARAM_PREFIX:"internal-"});var l=g.extend(function(v,u,t){g.call(this,v,"",u,t)},{getValues:function(u){var t=u.getPreference(this.getName(u));return t instanceof Array?t:[t]}});var o=b.extend(null,{toQueryString:function(u,t,v){return this.array.filter(function(w){return w.method==t&&(!v||w.destination==v)}).map(function(w){return w.toQueryString(u)}).join("&")},toJSONObject:function(u,t,w){var v={};this.array.filter(function(x){return x.method==t&&(!w||x.destination==w)}).forEach(function(x){var y=x.getName(u);v[y]=x.getValues(u).concat(v[y]||[])});return v}});var k=f.extend(function(x,w,v,u,t){f.call(this);var y=new h(x);y.getQuery()&&y.getQuery().split("&").forEach(function(z){var A=z.split("=");u.add(new g(A[0],A[1],"target","GET"))});this.uri=new j((y.getScheme()&&(y.getScheme()+":")||"")+(y.getAuthority()&&("//"+y.getAuthority())||"")+y.getPath());this.method=w;this.proxy=v;this.params=u;this.content=null;this.widget=t},{setContent:function(t){this.content=t;this.dispatchCustomEvent("content")},hasContent:function(){return Boolean(this.content)},getContentIterator:function(){return new i(this.content||[])},getContentURI:function(){var t=this.params.toQueryString(this.widget,"GET","target"),u=this.uri.generate(this.widget)+(t&&("?"+t));return this.proxy?gadgets.io.getProxyUrl(u,this.params.toJSONObject(this.widget,"GET","proxy")):h.resolve(u,this.widget.getOriginURI())},refresh:function(){var t=this;var v=this.getContentURI();var u=gadgets.io.makeRequest(v,function(x){var z=a.createElementFromString("<div>"+x.text+"</div>",t.widget.htmlNode.ownerDocument);var y=[];for(var w=0;w<z.childNodes.length;w++){y.push(z.childNodes[w])}t.setContent(y);t.widget.dispatchCustomEvent("includeRefreshed",true,true,{url:v,request:u,include:t})},{method:this.method,data:this.method=="POST"?this.params.toQueryString(t.widget,"POST"):""})},setUrl:function(t){if(t&&typeof t==="string"){var u=new h(t);u.getQuery()&&u.getQuery().split("&").forEach(function(v){var w=v.split("=");oParams.add(new g(w[0],w[1],"target","GET"))});this.uri=new j((u.getScheme()&&(u.getScheme()+":")||"")+(u.getAuthority()&&("//"+u.getAuthority())||"")+u.getPath())}}});this.HttpParam=g;this.HttpPreferenceParam=l;this.HttpParams=o;this.Include=k});b$.module("b$.portal._private.definition",function(){var w=b$.Class;var k=b$._private.uri.URI;var o=b$.portal.preferences.Preference;var f=b$.portal.preferences.Preferences;var l=b$.portal.preferences.types;var q=b$.portal._private.include.HttpPreferenceParam;var b=b$._private.htmlAPI;var m=b$.Class.extend(function(){this.factories={};this.builders={}},{buildWidget:function(x,y){var x=new k(x).resolve(new k(b$.portal.config.resourceRoot)).toString();if(!this.builders[x]){this.builders[x]=new g(x)}this.builders[x].getDefinition(function(z){y(z)})}});b$._private.AsyncComponentBuilder=m;var d="http://www.w3.org/1999/xhtml";var r="http://www.backbase.com/2008/gadget";var v="http://www.backbase.com/2006/tdl";var s="http://www.backbase.com/2006/client";var p=b$.portal._private.include.Include;var i=b$.portal._private.include.HttpParam;var u=b$.portal._private.include.HttpParams;var n=/(application|text)\/(x-)?backbase\+xml/;var a=/(application|text)\/(x-)?backbase\+(xml|ssr)/;var h=/(application|text)\/(x-)?backbase\+gadget\+xml/;var t=function(x,y){return function(z){return z.namespaceURI==x&&(z.localName||z.baseName)==y}};var g=b$.Class.extend(function(x){this.definition=null;this.loading=false;this.callbackQueue=[];this.sUrl=x;this.resources=null},{getDefinition:function(z){if(this.definition){z(this)}else{this.callbackQueue.push(z);if(!this.loading){this.loading=true;var x=new XMLHttpRequest();var y=this;x.onreadystatechange=function(){if(this.readyState==4){if(this.status==200||(this.status==0&&this.responseText!=="")){var B=this.responseText,A;var C=!!(navigator.userAgent.match(/Trident/)&&!navigator.userAgent.match(/MSIE/));if(window.ActiveXObject&&window.Performance||C){B=B.replace(/<!DOCTYPE[^>]+>/gi,"");A=new ActiveXObject("Microsoft.XMLDOM");A.async="false";A.loadXML(B)}else{A=new DOMParser().parseFromString(B,"application/xml")}y.definition=A;y.initializeDefinition();y.getResourcesFromDefinition(function(){for(var D=0;D<y.callbackQueue.length;D++){y.callbackQueue[D](y)}})}else{}}};x.open("GET",this.sUrl);x.send()}else{}}},initializeDefinition:function(){this.XTitle=this.getTitleFromDefinition();this.XIcon=this.getIconFromDefinition();this.XListeners=this.getEventListenersFromDefinition();this.XClasses=this.getClassesFromDefinition()},getTitleFromDefinition:function(){var y=b.getChildren(this.definition.documentElement);var A=y.filter(t(d,"head"));var z=b.getDescendants(A);var B=z.filter(t(d,"title"));var x=b.getContents(B);return x.map(function(C){return C.xml||new XMLSerializer().serializeToString(C)}).join("")},getIconFromDefinition:function(){var x=b.getChildren(this.definition.documentElement);var z=x.filter(t(d,"head"));var y=b.getDescendants(z);var A=y.filter(function(B){return B.namespaceURI==d&&(B.localName||B.baseName)=="link"&&B.getAttribute("rel")=="icon"});return A.length?k.resolve(A[0].getAttribute("href")||"",this.src):null},createEventHandlerFromString:function(x){return new Function("event",x.replace(/(__GADGET__|__WIDGET__)/gm,"this"))},getEventListenersFromDefinition:function(){var z=b.getChildren(this.definition.documentElement);var y=z.filter(t(d,"body"));var B=y[0];var A={};if(B){for(var C=0,D,x;D=B.attributes[C];C++){x=D.localName||D.baseName;if(D.namespaceURI=="http://www.backbase.com/2008/gadget"&&x.substr(0,2)=="on"){try{A[x.substr(2)]=this.createEventHandlerFromString(D.nodeValue)}catch(E){console.log(E)}}}}else{}return A},getClassesFromDefinition:function(){var z=b.getChildren(this.definition.documentElement);var y=z.filter(t(d,"body"));var A=y[0];var D=[];if(A){for(var B=0,C,x;C=A.attributes[B];B++){x=C.localName||C.baseName;if(x==="class"){D=C.nodeValue.split(/\s+/)}}}else{}return D},getPreferencesFromDefinition:function(z){if(!z.model){return}var A=b.getChildren(this.definition.documentElement);var C=A.filter(t(d,"head"));var D=b.getDescendants(C);var y=D.filter(t(r,"preferences"))[0];var F=b.getChildren(y);var x=this;var B=t(r,"preference");var E=0;var G=z.model.preferences;F.map(function(K){if(!B.apply(K,arguments)){}var H=K.getAttribute("type"),Q=K.getAttribute("default"),M=K.getAttribute("name"),O=K.getAttribute("viewHint"),J=K.getAttribute("manageable"),R=K.getAttribute("label")||M,I=K.getAttribute("onchange")||"";var L;if(H=="range"){L=new b$.portal.preferences.inputType.range();L.min=Number(K.getAttribute("min"));L.max=Number(K.getAttribute("max"));L.step=Number(K.getAttribute("step"))}else{if(H=="select-one"||H=="select-multiple"||H=="checkbox"||H=="checkbox-multiple"||H=="radio"){L=new b$.portal.preferences.inputType[H]();var P=b.getChildren(K).filter(t(r,"enumeration")).map(function(T){var U=T.getAttribute("value")||T.textContent||T.text;var S=T.getAttribute("label")||U;L.options.push({value:U,label:S})})}else{if(b$.portal.preferences.inputType[H]){L=new b$.portal.preferences.inputType[H]()}else{L=new b$.portal.preferences.inputType.text()}}}var N=G.getByName(M);if(N){N.inputType=L;G.remove(N);G.insert(N,E++)}else{N=z.model.ownerDocument.createPreference(M,"string");N.value=N.dataType.parseFromString(Q);N.label=R;N.viewHint=O;N.manageable=J&&J==="true";N.inputType=L;G.insert(N,E++)}if(I){N.addEventListener("change",x.createEventHandlerFromString(I),false,z)}})},getResourcesFromDefinition:function(y,x){b$.portal._private.definition.getResourcesFromDefinition(this.definition,this.sUrl,y,x)},getIncludesFromDefinition:function(y){var x=b.getChildren(this.definition.documentElement).filter(t(d,"body"));var A=b.getDescendants(x).filter(t(r,"include"));var z=this;function B(F){var D=y.model.preferences;var E=F.match(/\$\{(.*?)\}/g)||[];E.forEach(function(G){var J=G.replace("${","").replace("}","");var H=D.getByName(J);var I="";if(H){I=H.getValue()}F=F.replace(G,I)});F=F.replace("$(contextRoot)",b$.portal.portalModel.serverURL);return F}function C(E){var G=y.model.preferences.array;var D=[];for(var F=0;F<G.length;F++){if(G[F].dataType.name==E){D.push(G[F])}}return D}return A.map(function(D){return new p(D.getAttribute("src")?B(D.getAttribute("src")):"",(D.getAttribute("method")||"GET").toUpperCase(),(D.getAttribute("proxy")||"").toLowerCase()=="true",(function(){var E=[];var J=b.getChildren(D).filter(function(K){return K.namespaceURI==r&&/^(http-(proxy-|preference-)?)param(-map)?$/.test(K.localName||K.baseName)});for(var G=0;G<J.length;G++){var I=J[G].localName||J[G].baseName;if(I=="http-preference-param"){E.push(new q(J[G].getAttribute("name"),"target",(J[G].getAttribute("method")||"GET").toUpperCase()))}else{if(I=="http-preference-param-map"){var F=C(J[G].getAttribute("dataType"));for(var H=0;H<F.length;H++){E.push(new i((F[H].dataType.name+"."+F[H].name),F[H].value,"target",(J[G].getAttribute("method")||"GET").toUpperCase()))}}else{E.push(new i(J[G].getAttribute("name"),J[G].getAttribute("value"),I=="http-proxy-param"?"proxy":"target",(J[G].getAttribute("method")||"GET").toUpperCase()))}}}return new u(E)}()),y)})},getHTMLBodyFromDefinition:function(){var A=this.definition.documentElement.cloneNode(true),z=b.getChildren(A).filter(t(d,"body"))[0],C=new XMLSerializer(),E=this.src;b.getDescendants(z).forEach(function(I){var K=I.localName||I.baseName,J=I.namespaceURI,L="",H="";if(J==d&&/^(a|area|img|input|iframe|form)$/.test(K)){L=/^(a|area)$/.test(K)?"href":(/^(img|input|iframe)$/.test(K)?"src":"action");H=I.getAttribute(L);if(H){I.setAttribute(L,k.resolve(H,E))}}else{if(J==d&&K=="script"){var M=I.getAttribute("type");if(a.test(M)){console.log("BB4 Island disbled... "+M)}else{}}else{if(J==r&&K=="include"){var G=I.ownerDocument.createElement("div");G.setAttribute("class","bp-g-include");I.parentNode.replaceChild(G,I)}}}});var x=document.createElement("div"),D=A.getAttribute("style")||"",F=z.getAttribute("style")||"",B=A.getAttribute("class")||"",y=z.getAttribute("class")||"";x.innerHTML=("x<div"+((D||F)?' style="'+(D&&D+"; ")+F+'"':"")+((B||y)?' class="'+(B&&B+" ")+y+'"':"")+">"+b.getContents(z).map(function(G){return(G.xml||C.serializeToString(G)).replace(/<([\w:]+)([^>]*)\/>/gi,"<$1$2></$1>")}).join("")+"</div>");return x.lastChild}},{CSS_IMPORT_REGEXP:/@import\s+(?:'((?:[^\\']|\\.)*)'|"((?:[^\\"]|\\.)*)")/gm,CSS_URL_REGEXP:/url\(\s*(?:'((?:[^\\']|\\.)*)'|"((?:[^\\"]|\\.)*)"|((?:[^\\\)]|\\.)*))\s*\)/gm,CSS_ESCAPE_REGEXP:/\\([^\n\r\f0-9a-fA-F])|\\([0-9a-fA-F]{1,6})(?:\r\n|[ \n\r\t\f])?/g,unescapeCSSLiteral:function(x){return x.replace(g.CSS_ESCAPE_REGEXP,function(z,y,A){return y||String.fromCharCode(parseInt(A,16))})},resolveUrlsInCSS:function(y,x){return y.replace(g.CSS_URL_REGEXP,function(B,z,C,A){return"url('"+k.resolve(g.unescapeCSSLiteral(z||C||A),x).replace(/'/g,"\\'")+"')"}).replace(g.CSS_IMPORT_REGEXP,function(A,z,B){return"@import '"+k.resolve(g.unescapeCSSLiteral(z||B),x).replace(/'/g,"\\'")+"'"})}});function j(B){var x=[];var z=B.attributes;if(window.ActiveXObject&&!window.Performance){for(var A=0,y=z.length;A<y;A++){x.push({name:z[A].name,value:z[A].value})}}else{for(var A in z){if(z.hasOwnProperty(A)){x.push({name:z[A].name,value:z[A].value})}}}return x}var e=b$._private.ResourceSequence;this.getResourcesFromDefinition=function(H,x,G,y){var C=new e();var F=b.getChildren(H.documentElement);var D=F.filter(t(d,"head"))[0];var A=F.filter(t(d,"body"))[0];var B=b.getDescendants(D),E=b.getDescendants(A),z=x;B.filter(t(d,"link")).forEach(function(M){var L=M.getAttribute("href"),J=M.getAttribute("rel"),K=M.getAttribute("type")||"text/css";var I=j(M);L=L.replace("$(contextRoot)",b$.portal.portalModel.serverURL);if(J=="stylesheet"&&K=="text/css"&&!/standalone\.css$/.test(L)){C.addURI(K,k.resolve(L,z),null,I)}});B.filter(t(d,"script")).forEach(function(M){var J=M.getAttribute("src"),L=M.textContent||M.text,K=M.getAttribute("type")||"text/javascript";var I=j(M);if(J&&!/standalone\.js$/.test(J)){J=J.replace("$(contextRoot)",b$.portal.portalModel.serverURL);C.addURI(K,k.resolve(J,z),null,I)}else{if(!J&&L){C.addInline(K,L,null,I)}}});B.filter(t(d,"style")).forEach(function(L){var K=L.textContent||L.text,J=L.getAttribute("type")||"text/css";var I=j(L);if(K){C.addInline(J,K,null,I)}});E.filter(t(v,"tdl")).forEach(function(K){var I=b.getParents(K).filter(t(d,"script"))[0].getAttribute("type")||"text/javascript",J=new XMLSerializer();if(n.test(I)){}});C.startLoading(G,y);return};function c(y,A,x){var z=new XMLHttpRequest();z.onreadystatechange=function(){if(this.readyState==4){var C=(this.status+"").charAt(0);if(C=="0"||C=="2"||C=="3"){A(this)}else{var D=this;var B={readyState:D.readyState,responseText:D.responseText,status:D.status,statusText:D.statusText};x(B)}}};z.open("GET",encodeURI(y),false);z.send()}this.getResourcesFromDefinitionSynchronous=function(A,y,D){var z=b.getChildren(A.documentElement);var C=z.filter(t("http://www.backbase.com/ns/widgets","resources"))[0];var x=b.getDescendants(C);var B=y;x.filter(t(d,"link")).forEach(function(H){var I=H.getAttribute("href"),M=H.getAttribute("rel"),E=H.getAttribute("type")||"text/css";I=I.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var K=j(H);if(M=="stylesheet"&&E=="text/css"&&!/standalone\.css$/.test(I)){var L=document.createElement("link");for(var J=K.length-1;J>=0;J--){L.setAttribute(K[J].name,K[J].value)}L.type=E;L.href=k.resolve(I,B);var F=document.createAttribute("rel");F.nodeValue="stylesheet";L.setAttributeNode(F);var G=document.getElementsByTagName("head")[0];G.appendChild(L)}});x.filter(t(d,"script")).forEach(function(I){var E=I.getAttribute("src"),K=I.textContent||I.text,F=I.getAttribute("type")||"text/javascript";var L=j(I);if(E&&!/standalone\.js$/.test(E)){E=E.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var M=document.createElement("script");M.type=F;for(var J=b$._private.resourceManager.resources.length-1;J>=0;J--){if(b$._private.resourceManager.resources[J].uri==k.resolve(E,B)){return}else{var G=new e();G.addURI(F,k.resolve(E,B),null,L)}}c(k.resolve(E,B),function(P){M.text=P.responseText;var O=document.getElementsByTagName("head")[0];O.appendChild(M)})}else{if(!E&&K){var N=document.createElement("script");N.type=F;N.text=K;var H=document.getElementsByTagName("head")[0];H.appendChild(N)}}});x.filter(t(d,"style")).forEach(function(J){var G=J.textContent||J.text,F=J.getAttribute("type")||"text/css";var E=j(J);if(G){var I=document.createElement("style");I.type=F;if(I.styleSheet){I.styleSheet.cssText=G}else{I.appendChild(document.createTextNode(G))}var H=document.getElementsByTagName("head")[0];H.appendChild(I)}});if(D){D()}};this.getResourcesFromConfig=function(x,A){var z=x.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var y=new XMLHttpRequest();y.onreadystatechange=function(){if(this.readyState==4){var E=(this.status+"").charAt(0);if(E=="0"||E=="2"||E=="3"){var D=this.responseText,B;if(window.ActiveXObject&&window.Performance){B=new ActiveXObject("Microsoft.XMLDOM");B.async="false";B.loadXML(D)}else{B=new DOMParser().parseFromString(D,"application/xml")}b$.portal._private.definition.getResourcesFromDefinitionSynchronous(B,z,A)}else{var C={readyState:this.readyState,responseText:this.responseText,status:this.status,statusText:this.statusText};console.log(C)}}};y.open("GET",encodeURI(z),false);y.setRequestHeader("Content-Type","application/xml");y.send(null)}});b$.module("b$.portal.view.bdom.default",function(){var e=function(){return this}();var f=b$.bdom.Namespace;var o=b$.view.bdom.Component;var s=b$.view.perspective.Perspective;var p=b$.view.perspective.PerspectiveType;var j=b$.view.perspective.PerspectiveParameters;var m=b$._private.template.SimpleURITemplate;var c=b$._private.htmlAPI;var u=b$._private.xml;var i=f.extend(function(w){f.call(this,w)},{});var r=new i("http://backbase.com/2012/portalView");this.NS=r;var q=function(x,A,z,w){var y=this;b$.portal.portalServer.loadItemHTML(x.originalItem,function(F,E){var D=F.substring(0,F.indexOf("<body>"))+"</html>";var B=F.substring(F.indexOf("<body>")+6,F.indexOf('<script type="text/backbase-xml'));var G="";if(F.indexOf('<script type="text/backbase-xml">')!==-1){G=F.substring(F.indexOf('<script type="text/backbase-xml">')+33,F.indexOf("<\/script>",F.indexOf('<script type="text/backbase-xml">')+33))}var C=u.parse(D);b$.portal._private.definition.getResourcesFromDefinition(C,"",function(){var L=c.createElementFromString(B);var J=x.ownerDocument;x.destroy();var I=u.parse(G);var K=b$.portal.importPortalModel(I,J,null,L);if(z){z(K,E)}var H=L.viewController;if(H.ownerDocument.documentElement.designMode){H.enableDesignMode()}},function(){var J=c.createElementFromString("<span>This part of the page can't be rendered </span>");J.viewController=A.viewController;A.appendChild(J);var H=u.parse(G);var I=b$.portal.portalServer.itemXMLDOC2JSON(H);x.setItem(I);if(z){z()}})},w,true)};b$.portal.refreshHTML=q;var h={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4};var b=r.registerElement("deprecatedElement",o.extend(function(y,x,w,z){o.apply(this,arguments)},{namespaceURI:"http://backbase.com/2012/portalView",buildHTML:function(w){if(!w){w=c.createElementFromString(this.doTemplate(this.buildJSON()))}return w},buildDisplay:function(){this.htmlNode=this.buildHTML(this.htmlNode);if(!this.htmlAreas){var w=this.getDisplay("area",true);if(!w.length){w=c.findCaptureClass("bp-area",this.htmlNode)}this.htmlAreas=w}if(this.htmlNode){this.htmlNode.viewController=this}return this.htmlNode},attachHTMLChildren:function(){var y=this.getAreaOrderedChildren();var x=false;for(var A=0;A<y.length;A++){if(y[A]){var z=0;var C=y[A][z].getHTMLNode();var B=this.htmlAreas[A];if(!B){B=this.htmlAreas[this.htmlAreas.length-1]}var w=B.firstChild;if(!w){B.appendChild(C);x=true}else{while(w){if(w.nodeType==1&&w.viewController){var C=y[A][z].getHTMLNode();if(w.viewController==y[A][z]){}else{w.parentNode.insertBefore(C,w)}z++;if(z==y[A].length){break}}w=w.nextSibling}}while(z<y[A].length){var C=y[A][z].getHTMLNode();z++;B.appendChild(C)}}}}}));b$.mixin(b.prototype,b$.bdom.BOldNode);var d=r.registerElement("portalViewElement",b.extend(function(y,x,w,z){b.apply(this,arguments);if(this.ownerDocument.defaultDragHandlers){this.addHandlers(this.ownerDocument.defaultDragHandlers)}},{namespaceURI:"http://backbase.com/2012/portalView",dragIsTarget:function(){return this.isPossibleDragTarget},refreshHTML:function(A,w){var z=this.model.parentNode;var x=this.ownerDocument;q(this.model,null,function(E,B){var D,C;z.appendChild(E);D=x.all[b$.portal.portalReflector.getID(z)];C=x.all[b$.portal.portalReflector.getID(E)];D.insertDisplayChild(C);if(A){A(C,B)}});return;var y=this;b$.portal.portalServer.loadItemHTML(this.model.getJSON(),function(E){var D=E.substring(0,E.indexOf("<body>"))+"</html>";var B=E.substring(E.indexOf("<body>")+6,E.indexOf('<script type="text/backbase-xml"'));var F="";if(E.indexOf('<script type="text/backbase-xml">')!==-1){F=E.substring(E.indexOf('<script type="text/backbase-xml">')+33,E.indexOf("<\/script>",E.indexOf('<script type="text/backbase-xml">')+33))}var C=u.parse(D);b$.portal._private.definition.getResourcesFromDefinition(C,"",function(){if(y.htmlNode!=null){y.htmlNode.innerHTML=""}var J=c.createElementFromString(B);if(!J){J=c.createElementFromString("<span>"+B+"</span>")}J.viewController=y.htmlNode.parentNode.viewController;y.htmlNode.parentNode.insertBefore(J,y.htmlNode);var H=y.model.parentNode;y.model.destroy();var G=u.parse(F);var I=b$.portal.portalServer.itemXMLDOC2JSON(G);b$.portal._buildModelFromJSON(H.ownerDocument,I,H);if(A){A()}})},w,true)},loadChildren:function(B,A){var y=[];if(!this.model._children){return}if(B){y.push(B)}else{y=this.model._children}var x=this;for(var w=y.length-1;w>=0;w--){if(b$.portal.portalModel.getElementById(y[w].name)){break}var z=function(E,H){var G=E.substring(0,E.indexOf("<body>"))+"</html>";var C=E.substring(E.indexOf("<body>")+6,E.indexOf('<script type="text/backbase-xml'));var I="";if(E.indexOf('<script type="text/backbase-xml">')!==-1){I=E.substring(E.indexOf('<script type="text/backbase-xml">')+33,E.indexOf("<\/script>",E.indexOf('<script type="text/backbase-xml">')+33))}var D=function(){var R=b$._private.htmlAPI.createElementFromString(C);var S=b$._private.xml.parse(I);var P=0;var L=0;var K=navigator.userAgent.toLowerCase();if(!(K.indexOf("msie")!=-1)&&parseInt(K.split("msie")[1])>9){P=b$._private.xml.textContent(b$.ua.querySelector(S,"property[name=area] value"))||0;L=b$._private.xml.textContent(b$.ua.querySelector(S,"property[name=order] value"))||0}var N=x.htmlAreas[P];var O=true;var Q=null;for(var M=0;M<N.childNodes.length;M++){if(N.childNodes[M].getAttribute("data-pid")==R.getAttribute("data-pid")){O=false;break}else{if(L<N.childNodes[M].viewController.getPreference("order")){Q=N.childNodes[M]}}}if(O){if(Q){N.insertBefore(R,Q)}else{N.appendChild(R)}}var J=b$.portal.importPortalModel(S,b$.portal.portalModel,x.model,R);if(A){A(R.viewController)}};var F=b$._private.xml.parse(G);b$.portal._private.definition.getResourcesFromDefinition(F,"",D)};b$.portal.portalServer.loadItemHTML(y[w],z,null,true,-1,null)}},getPreference:function(w){if(this.model){return this.model.getPreference(w)}return this.getAttribute(w)},setPreference:function(w,x){return this.model.setPreference(w,x)},isPreference:function(w){var x=this.getPreference(w);return x!=null&&x!=""},getAreaPreference:function(){if(this.area===undefined){if(this.model){var w=parseInt(this.model.getPreference("area"),10);if(isNaN(w)){w=0}}else{var w=parseInt(this.getAttribute("area"),10);if(isNaN(w)){w=0}}return w}else{return this.area}},getOrderPreference:function(){if(this.order===undefined){if(this.model){var w=parseInt(this.model.getPreference("order"),10);if(isNaN(w)){w=0}}else{var w=parseInt(this.getAttribute("order"),10);if(isNaN(w)){w=0}}return w}else{return this.order}},m_dragEnter:function(B,A){var z=h[this.model.securityProfile];if(z<h.CONTRIBUTOR){return false}var w=B.clientX;var C=B.clientY;this.appendChild(this.ownerDocument.dragIndicator)},m_dragOut:function(E,A){var z=h[this.model.securityProfile];if(z<h.CONTRIBUTOR){return false}var w=E.clientX;var F=E.clientY;var C=this.ownerDocument.dragIndicator.getDisplay();if(C){C.parentNode.removeChild(C);this.removeChild(this.ownerDocument.dragIndicator)}delete this.tmp_lastTargetAreaId;var D=this.childNodes;for(var B=0;B<D.length;B++){D[B].tmp_order=D[B].order;delete D[B].area;delete D[B].order}this.reflow()},m_dragMove:function(N,L){var C=h[this.model.securityProfile];if(C<h.CONTRIBUTOR){return false}var w=document.body.scrollTop?document.body.scrollTop:document.body.parentNode.scrollTop?document.body.parentNode.scrollTop:0;var M=document.body.scrollLeft?document.body.scrollLeft:document.body.parentNode.scrollLeft?document.body.parentNode.scrollLeft:0;var E=N.clientX+M;var D=N.clientY+w;var J=this.getDisplay("area",true);if(!J.length){J=c.findCaptureClass("bp-area",this.htmlNode)}var B=null;var W=null;var I=Infinity;var G="";for(var P=0;P<J.length;P++){var H=c.getBoxObject(J[P],"border");if(l(E,D,H.x,H.y,H.w,H.h)){B=P;break}var T=Math.abs((H.x+H.w/2)-E)+Math.abs((H.y+H.h/2)-D);if(T<I){I=T;W=P}}if(B==null){if(this.tmp_lastTargetAreaId){B=this.tmp_lastTargetAreaId}else{if(W==null){B=0}else{B=W}}}this.tmp_lastTargetAreaId=B;var O=null;var R=L.dataTransfer.getData("x-bb-nodelist");if(R&&R[0]){O=R[0]}var V=J[B];L.__tmpArea=B;L.__tmpOrder=0;this.ownerDocument.dragIndicator.area=B;var A=this.getAreaOrderedChildren();var S=A[B];var K=false;if(S){for(var P=0;P<S.length;P++){if(S[P]!=this.ownerDocument.dragIndicator){if(!K){var H=c.getBoxObject(S[P].htmlNode,"border");if((this.layout.dir.direction=="horizontal"&&E<H.x+(H.w/2))||(this.layout.dir.direction=="vertical"&&D<H.y+(H.h/2))){K=true;this.ownerDocument.dragIndicator.order=L.__tmpOrder;var F=this.ownerDocument.dragIndicator.getDisplay();var Q=S[P].getDisplay();Q.parentNode.insertBefore(F,Q);L.__tmpOrder++;if(O==S[P].model){F.display="none"}else{F.display="block"}}}S[P].order=L.__tmpOrder;L.__tmpOrder++}}}if(!K){this.ownerDocument.dragIndicator.order=L.__tmpOrder;if(!J[B]){console.log("____________________________________________",this)}J[B].appendChild(this.ownerDocument.dragIndicator.getDisplay())}var z=this.ownerDocument.dragIndicator;var O;var U=L.dataTransfer.getData("x-bb-nodelist");if(U){O=U[0]}z.getDisplay().style.display="block";if(!L.dragOptions.htmlNode.catalogItemJson){if(O.parentNode==z.parentNode){if(O.getAreaPreference()==z.area){if(O.order+1==z.order||O.order-1==z.order){z.getDisplay().style.display="none"}}}}this.reflow();return},m_dragDrop:function(x,H,F){var B=h[this.model.securityProfile];if(B<h.CONTRIBUTOR){return false}var A=F;if(A.isCatalog){}else{var E=A.parentNode;var w=E.childNodes;if(this!=E){for(var G=0;G<w.length;G++){if(A!=w[G]){w[G].model.setPreference("order",w[G].tmp_order);w[G].model.save()}}}}var w=this.childNodes;for(var G=0;G<w.length;G++){if(A!=w[G]&&w[G].tmp_order){w[G].model.setPreference("order",w[G].tmp_order);w[G].model.save()}}if(A.isCatalog&&H.dragOptions.htmlNode&&H.dragOptions.htmlNode.catalogItemJson){var J=this.model.createExtendedElementFromJSON(H.dragOptions.htmlNode.catalogItemJson);if(H.dragOptions.htmlNode.catalogItemJson.children){for(var G=0,D=H.dragOptions.htmlNode.catalogItemJson.children.length;G<D;G++){var C=this.model.createExtendedElementFromJSON(H.dragOptions.htmlNode.catalogItemJson.children[G]);J.appendChild(C,true)}}var I=this.model;J.parentItemName=I.name;var y=J.getPreferenceNode("area");if(y){J.setPreference("area",this.ownerDocument.dragIndicator.area+"")}else{y=this.model.ownerDocument.createPreference("area","string");y.value=this.ownerDocument.dragIndicator.area+"";J.setPreferenceNode(y)}var y=J.getPreferenceNode("order");if(y){J.setPreference("order",this.ownerDocument.dragIndicator.order+"")}else{y=this.model.ownerDocument.createPreference("order","double");y.value=this.ownerDocument.dragIndicator.order+"";J.setPreferenceNode(y)}var z=this;J.save(function(){if(!J.contextItemName){I.appendChild(J)}else{q(J,z.htmlNode,function(M){var L,K;I.appendChild(M);L=z.ownerDocument.all[b$.portal.portalReflector.getID(I)];K=z.ownerDocument.all[b$.portal.portalReflector.getID(M)];L.insertDisplayChild(K)})}})}else{A.model.setPreference("area",this.ownerDocument.dragIndicator.area.toString());var y=A.model.getPreferenceNode("order");if(y){A.model.setPreference("order",this.ownerDocument.dragIndicator.order+"")}else{y=this.model.ownerDocument.createPreference("order","double");y.value=this.ownerDocument.dragIndicator.order+"";A.model.setPreferenceNode(y)}A.model.parentItemName=this.model.name;this.model.appendChild(A.model);A.model.save()}if(E){E.reflow()}this.reflow()},createPerspective:function(w,x){return new s(new m("/","page"),w,x)},getCurrentPerspective:function(){return this.perspective},setCurrentPerspective:function(w){this.perspective=w},addHandlers:function(w){for(var x in w){if(w.hasOwnProperty(x)){this.addEventListener(x,w[x])}}},removeHandlers:function(w){for(var x in w){if(w.hasOwnProperty(x)){this.removeEventListener(x,w[x])}}},processConfig:function(){try{var x=this.getPreference("config");if(x){var w=JSON.parse(x);b$.mixin(this,w)}}catch(y){console.log("Error parsing config: "+y)}},persistConfig:function(){try{var y=this.getPreference("config");var w=JSON.parse(y);for(var x in w){if(w[x]!==this[x]){w[x]=this[x]}}y=JSON.stringify(w);this.setPreference("config",y);this.model.save()}catch(z){console.log("Error persisting config: "+z)}},addToConfig:function(w,A){try{var y=this.getPreference("config");var x=JSON.parse(y);x[w]=A;y=JSON.stringify(x);this.setPreference("config",y);this.model.save()}catch(z){console.log("Error adding preference to config: "+z)}},removeFromConfig:function(w){try{var y=this.getPreference("config");var x=JSON.parse(y);delete x[w];y=JSON.stringify(x);this.setPreference("config",y);this.model.save()}catch(z){console.log("Error removing preference from config: "+z)}}}));this.portalViewElement=d;function k(x,w){x=parseInt(x.getOrderPreference())||0;w=parseInt(w.getOrderPreference())||0;return x-w}function l(C,A,z,E,B,D){if(C>=z&&C<=z+B&&A>=E&&A<=E+D){return true}return false}var t=b$.view.bdom.layout;var v=r.registerElement("application",d.extend(function(y,x,w,z){d.apply(this,arguments);this.layout=new t.NoLayout(this)},{doTemplate:function(w){},buildHTML:function(w){return w},readyHTML:function(){},insertDisplayChild:function(w){},showDesignTools:function(){},hideDesignTools:function(w){}}));var a=r.registerElement("portal",d.extend(function(y,x,w,z){d.apply(this,arguments);this.perspective=this.createPerspective(new p("Dashboard"),new j());this.addEventListener("PerspectiveModified",function(A){this.setCurrentPerspective(this.createPerspective(new p(A.newValue),new j()))},false,this)},{doTemplate:function(w){return'<div class="'+this.cls+" "+this.cls+'--area"></div>';return'<div class="'+this.cls+'"><div class="'+this.cls+'--area"></div></div>'},injectDisplaySelf:function(){},insertDisplayChild:function(w){if(!(w.model&&w.model._ssr)){b$._private.ssrRootElement.appendChild(w.htmlNode)}},attachHTMLChildren:function(){var w=this.childNodes;for(var x=0;x<w.length;x++){var y=w[x].getHTMLNode();if(!y.parentNode||y.parentNode.nodeType!=1){document.body.appendChild(y)}}},showDesignTools:function(){},hideDesignTools:function(){}}));var n=r.registerElement("page",d.extend(function(y,x,w,z){d.apply(this,arguments);this.layout=new t.NoLayout(this);this.isPossibleDragTarget=true},{pageType:undefined,doTemplate:function(w){return'<div class="'+this.cls+'"><div class="'+this.cls+'--area"></div></div>'},buildDisplay:function(y){if(!this.htmlNode){this.htmlNode=this.buildHTML(y);var x=this.getDisplay("area",true);if(!x.length){x=c.findCaptureClass("bp-area",this.htmlNode)}this.htmlAreas=x;return}if(!this.htmlAreas){this.htmlAreas=[];var w=c.findCaptureClass("bp-area",this.htmlNode);if(w[0]){c.addClass(w[0],"--area");this.htmlAreas.push(w[0])}}if(this.model.manageable){this.pageType="master"}else{if(this.model.extendedItemName==""){this.pageType="normal"}else{this.pageType="inherited"}}},readyHTML:function(){d.prototype.readyHTML.call(this)},showDesignTools:function(){},hideDesignTools:function(){}}));var g=r.registerElement("dragIndicator",d.extend(function(y,x,w,z){d.apply(this,arguments);this.layout=new t.AutoLayout(this);this.isPossibleDragTarget=false;this.flex=1;this.area=0;this.order=0},{setHTMLWidthHeight:function(x,w){var y=this.htmlNode;c.setWidthHeightPB(y,x,w);c.setWidthHeightPB(y.firstChild,x-c.getPadding(y)-c.getBorder(y),w-c.getPadding(y,"tb")-c.getBorder(y,"tb"))},buildHTML:function(w){if(!w){w=document.createElement("div");w.className="bp-drag-indicator";w.innerHTML='<div class="bp-drag-indicator-in"><span class="bp-drag-text"></span></div>'}return w},getAreaPreference:function(){return this.area},getOrderPreference:function(){return this.order},setAreaPreference:function(w){this.area=w},setOrderPreference:function(w){this.order=w}}))});b$.module("b$.portal.view.bdom.container",function(){var b=b$.Class;var e=b$._private.htmlAPI;var d=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var c=d.getClass("portalViewElement");var g=b$.view.preferences;var f=b$.view.bdom.layout;var a=d.registerElement("container",c.extend(function(j,i,h,k){c.apply(this,arguments);this.layout=new f.NoLayout(this)},{buildHTML:function(j){var h=document;if(!j){var i=this.getContainerTemplate();if(!j){j=e.createElementFromString(i,h)}}return j},getContainerTemplate:function(){var h='<div class="bp-container"><div class="bp-container-pref"></div><div class="bp-area"></div></div>';return h},appendPreferencesForm:function(i,l,h){return;var j=g.showPreferencesPane(document,l);var k=e.cssSelector(".bp-container-pref",i);k.appendChild(j.getDisplay())},constrainProportions:function(l,h){var n=0,k,j,m;m=l.concat(new Array(h)).splice(0,h);for(j=0;j<h;j++){m[j]=Math.round((m[j]||0)*100)/100;n+=m[j]}if(n===0){for(j=0;j<h;j++){m[j]=Math.round(100/h*100)/100}}else{if(n!==100){k=n/100;for(j=0;j<h;j++){m[j]=m[j]/k}}}return m}}))});b$.module("b$.portal.view.bdom.widget",function(){var j=function(){return this}();var e=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var f=b$.view.perspective.Perspective;var i=b$._private.template.SimpleURITemplate;var g=b$._private.htmlAPI;var c=b$._private.simpleResponseCache_getData;var d=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var b=d.getClass("portalViewElement");var h=d.registerElement("widget",b.extend(function(m,l,k,n){b.apply(this,arguments);this.id="none";this.flex=1},{buildHTML:function(l){var k=document;if(!l){l=b$.portal.view.loadChrome(this,k)}this.bindChromeHandlers();this.htmlAreas=[];this.htmlAreas[0]=g.cssSelector(".bp-widget-body",l)[0];return l},setHTMLWidthHeight:function(l,k){var m=this.htmlNode;if(l!==undefined){g.setWidth(m,l)}if(k!==undefined){g.setHeight(m,k);g.setHeightPB(this.htmlAreas[0],k-this.htmlHead.offsetHeight-this.htmlFoot.offsetHeight)}},readyHTML:function(){var k=this;if(this.ownerDocument.defaultDragHandlers){this.addHandlers(this.ownerDocument.defaultDragHandlers)}this.id=this.model.name;if(k.model){k.model.addEventListener("PrefModified",function(n){if(n.target===k.model){var l=n.relatedNode;if(l){var m=this.ownerDocument.createEvent("UIEvent");m.initUIEvent("change",true,false,window,null);l.dispatchEvent(m,false)}}},false,k);k.model.addEventListener("PrefFallback",function(l){if(l.target===k.model){k.refreshHTML()}},false,k);this.addEventListener("PerspectiveModified",function(m){if(m.target.model===this.model&&(m.newValue==="Maximized"||m.newValue==="Widget")){var l=this.ownerDocument.createEvent("MutationEvent");l.initMutationEvent(m.newValue==="Maximized"?"maximize":"restore",true,false,this,null,null,null,null);this.model.dispatchEvent(l,true)}},false,this)}},bindChromeHandlers:function(){var k=this;g.bindEvent(this.htmlNode,"click",function(o){var q=o.target;var p;var m=g.cssSelector(".bp-widget-pref",this)[0];while(true){p=q.getAttribute("data-action");if(p){switch(p){case"widget-preferences":k.dispatchCustomEvent("preferences-form",true,true,{context:k});break;case"widget-maximize":k.setPerspective("Maximized");break;break;case"widget-restore":k.setPerspective("Widget");q.setAttribute("data-action","widget-minimize");break;case"widget-minimize":k.setPerspective("Minimized");q.setAttribute("data-action","widget-restore");break;case"widget-refresh":k.refreshHTML();break;case"widget-close":k.model.destroyAndSave();break;case"pref-ok":var n=g.cssSelector("form",m)[0];for(var l=0;l<n.elements.length;l++){var r=n.elements[l];if(r.type==="text"){if(r.value!==k.model.getPreference(r.name)){console.log(r.name,r.value);k.model.setPreference(r.name,r.value)}}else{if(r.type==="checkbox"){if(r.checked!==k.model.getPreference(r.name)){console.log(r.name,r.checked);k.model.setPreference(r.name,r.checked)}}}}k.model.save();m.style.display="none";break;case"pref-cancel":m.style.display="none";break}}if(q==o.currentTarget){break}q=q.parentNode;if(!q){break}}})},setTitle:function(k){this.model.setPreference("title",k);this.model.save()},getDefinition:function(){return{}},setPerspective:function(l){if(l!==this.perspective.getType().getName()){this.perspective=new f(new i(this.getDefinition().sUrl||this.sSrc,"page"),new e(l),new a());var k=this.ownerDocument.createEvent("MutationEvent");k.initMutationEvent("PerspectiveModified",true,false,this,this.perspective,l,null,null);this.dispatchEvent(k)}},getContextVariableValue:function(l){var k=this.perspective.getParameters().getByName(l);return k&&k.getValue()||""}}));this.Widget=h;defaultChrome='<div class="bp-widget Xbp-ui-dragRoot Xbp-ui-dragGrip"><div class="bp-widget-head"></div><div class="bp-widget-pref"></div><div class="bp-widget-body"></div><div class="bp-widget-foot"></div></div>';var g=b$._private.htmlAPI;b$.portal.view.loadChrome=function(r,q){var m={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4};var o=r.model;var k={};if(o){k=o.getJSON()}var s=r.getAttribute("widgetChrome");if(s){s=s.replace("$(contextRoot)",b$.portal.portalModel.serverURL);k.widgetTitle=r.getAttribute("title");var n=c(s)}else{var n=defaultChrome}if(o){var l=m[o.securityProfile];k.showEdit=l>=m.CONTRIBUTOR;k.showDelete=l>=m.CREATOR;k.enableDND=l>=m.CONTRIBUTOR;k.showMaximize=true}var p=g.createElementFromString(Mustache.to_html(n,k),q);return p}});b$.module("b$.portal.view.bdom.widget.backbase",function(){var d=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var h=d.getClass("widget");var e=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var f=b$.view.perspective.Perspective;var i=b$._private.template.SimpleURITemplate;var g=b$._private.htmlAPI;var b=new b$._private.AsyncComponentBuilder();var c=d.registerElement("backbaseWidget",h.extend(function(l,k,j,m){h.apply(this,arguments)},{buildHTML:function(k){var j=document;if(!k){k=b$.portal.view.loadChrome(this,j)}else{this.htmlNode=k}this.bindChromeHandlers();this.htmlHead=g.cssSelector(".bp-widget-head",k)[0];this.htmlFoot=g.cssSelector(".bp-widget-foot",k)[0];this.htmlAreas=[];this.htmlAreas[0]=g.cssSelector(".bp-widget-body",k)[0];this.body=this.htmlAreas[0];this.buildWidget();return k},readyHTML:function(){h.prototype.readyHTML.call(this)},buildWidget:function(){var j=this.getAttribute("src");j=j.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var k=this;b.buildWidget(j,function(r){k.myDefinition=r;k.includes=r.getIncludesFromDefinition(k);r.getPreferencesFromDefinition(k);var q=(k.body&&k.body.firstChild)?true:false;if(!q){k.body.appendChild(r.getHTMLBodyFromDefinition())}var p=k.body;var s=g.cssSelector(".bp-g-include",p);if(s.length){for(var n=0;n<k.includes.length;n++){var l=k.includes[n];l.htmlNode=s[n];l.addEventListener("content",function(){this.htmlNode.innerHTML="";for(var t=0;t<this.content.length;t++){this.htmlNode.appendChild(this.content[t])}})}}if(k.model){for(var o in r.XListeners){if(r.XListeners.hasOwnProperty(o)){k.model.addEventListener(o,r.XListeners[o],false,k)}}}var m=k.ownerDocument.documentElement;k.perspective=new f(new i(k.myDefinition.sUrl,"page"),new e("Dashboard"),new a());if(!q){k.refreshIncludes()}if(r.XListeners.load){r.XListeners.load.call(k)}})},refreshIncludes:function(){for(var k=0,j=this.includes.length;k<j;k++){this.includes[k].refresh()}},getOriginURI:function(){return this.getDefinition().sUrl},getDefinition:function(){return this.myDefinition},getBody:function(){return this},getIncludes:function(){return this.includes}},{handlers:{}}))});b$.module("b$.portal.view.bdom.widget.w3c",function(){var f=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var e=f.getClass("widget");var d=b$._private.htmlAPI;var c=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var h=b$.view.perspective.Perspective;var b=b$._private.template.SimpleURITemplate;var g=f.registerElement("w3cWidget",e.extend(function(k,j,i,l){e.apply(this,arguments)},{buildHTML:function(m){if(m){var l=d.cssSelector(".bp-widget-body > iframe",m)[0];var i=this.getAttribute("src");if(!i){i=this.getAttribute("defaultStartFile")}i=i.replace("$(contextRoot)",b$.portal.portalModel.serverURL);l.setAttribute("src",i);this.bindChromeHandlers();this.htmlAreas=[];this.htmlAreas[0]=d.cssSelector(".bp-widget-body",m)[0];this.body=this.htmlAreas[0];this.htmlHead=d.cssSelector(".bp-widget-head",m)[0];this.htmlFoot=d.cssSelector(".bp-widget-foot",m)[0]}else{var k=document;var m=b$.portal.view.loadChrome(this,k);this.htmlAreas=[];this.htmlAreas[0]=d.cssSelector(".bp-widget-body",m)[0];this.body=this.htmlAreas[0];var i=this.getAttribute("src");if(!i){i=this.getAttribute("defaultStartFile")}i=i.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var j=this.model.name;var l=d.createElementFromString('<iframe style="width:100%; height:100%;" frameborder="0"></iframe>',k);l.setAttribute("src",i);l.setAttribute("data-widgetInstanceId",j);this.htmlAreas[0].appendChild(l)}this.perspective=new h(new b(i,"page"),new c("Dashboard"),new a());this.sSrc=i;return m}}))});